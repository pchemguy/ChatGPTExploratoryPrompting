## ChatGPT assisted prompt debugging and fixing

I wanted to test-drive ChatGPT on another coding exercise in the area of information management. The first step was to come up with a data model and associated database schema. When generating potentially reusable code with ChatGPT, it is generally a good idea to submit appropriate style guidelines before actually generating code. So I worked out [Python][Python Style Guidelines] and [SQL][SQL Style Guidelines] style guidelines to be used with ChatGPT. I submitted SQL style guidelines, did some iterative schema development, asked ChatGPT to generate dummy code for testing purposes, and finally decided to verify the database schema and dummy data. When ChatGPT attempted to execute the Python script it generated for loading the schema and dummy data, it could not access previously generated schema file. This is normal, as the temporary files generated by ChatGPT on the server, such as scripts may be deleted at any time, I think. Or maybe I actually did not instruct ChatGPT to create the schema file on the server. I did create and saved locally schema blueprint. I also saved schema, but I asked ChatGPT to reconstruct the schema file from the blueprint specification (the actual schema blueprint is unimportant and not shown):

**ChatGPT prompt**

```
Use this blueprint to regenerate the schema file:

{SCHEMA BLUEPRINT}
```

ChatGPT created the file with SQL code, but this time it decided to ignore my SQL style guidelines (when I was developing the schema interactively initially, ChatGPT did follow the guidelines).

That was unfortunate, and I wanted to figure out what was going on. In such a situation, the first order of business is to check memory context, hence I asked:

**ChatGPT prompt**

```
Tell me about currently applicable guidelines for SQL code
```

Usually, ChatGPT would not spit out an exact copy of the previously submitted text, but by examining the generated output and comparing it to the originally submitted text, it might be possible to spot or rule out major issues with the memory context. The output actually looked ok, but I, nevertheless, proceeded to updating memory context (`{SQL STYLE GUIDELINES}` is a placeholder, the actual prompt contained the contents of the [file][defective-ddl]):

**ChatGPT prompt**

```
Replace currently applicable SQL Style Guidlines with new ones:

{SQL STYLE GUIDELINES}
```

ChatGPT confirmed the operation (by indicating `Memory updated` and `The SQL Style Guidelines have been successfully updated`) and I attempted to generate the schema file again with the same result. I tried to tweak the SQL style guidelines, adding additional emphasis to the ignored style rules, repeated the cycle, but the result was still the same. Next, I tried to tweak the prompt:

**ChatGPT prompt**

```
Use the following blueprint to generate the schema.sql file. Verify that schema.sql follows all applicable guidelines and adjust it if necessary.

{SCHEMA BLUEPRINT}
```

ChatGPT generated the schema files, ignored the style rules, but reported that the generated code did follow applicable guidelines. Next I decided to add one of the ignored style rules to the prompt directly:

**ChatGPT prompt**

```
Use the following blueprint to generate the schema.sql file. Generated schema file must include detailed comments.

{SCHEMA BLUEPRINT}
```

This time the explicitly included style rule was applied. Great! At this point I decided to start a new conversation / chat to verify behavior. I submitted style guides as before, asked to generate the schema file from its blueprint, and ChatGPT ignored relevant style rules as before. So I decided to encourage ChatGPT to share its reasoning:

**ChatGPT prompt**

```
Instructions:
Use the following blueprint to generate the schema.sql file.

Additional instructions:
Before producing the schema.sql file, show me detailed work. I am in particularly interested in understanding your considerations as to which memory context items are applicable to present task.

{SCHEMA BLUEPRINT}
```

ChatGPT did spit out additional information per request, which appeared reasonable, but not particularly insightful. So this time I decided to ask it directly about the specific rules it had ignored (I copied one of the ignored rules and added it to the prompt):

**ChatGPT prompt**

```
Explain why you did not follow this instruction "- Align column definitions after the column names." Is it not applicable? Why?
```

I did acknowledge that it ignored the rule, but more importantly this time it provided a detailed and completely reasonable explanation. Great! So I decided to ask ChatGPT to help me fix the prompt:

**ChatGPT prompt**

```
Help me improve the following SQL Style Guidelines (I will provide specific request in the following message):

{SCHEMA BLUEPRINT}
```

After confirmation, I submitted the second prompt that included desired specifications:

**ChatGPT prompt**

```
I want to make sure that when DDL code (schemas) is generated, the following formatting rules are enforced, unless specifically requested otherwise:

- All identifiers are quoted
- Column definitions are aligned after the column names.
- Detailed comments are provided and aligned for column definition rows.
- Single column UNIQUE and PRIMARY KEY constraints should always be included as part of column definition and just use bare keywords.
- Single-column constraints (except for UNIQUE and PRIMARY KEY) should be included as the last part of column definition. The constraints should include descriptive names, each start on a new line, and be indented by four spaces relative to column name.
```

ChatGPT produced revised style guidelines, I switched to a new chat again, used the revised [guidelines][SQL Style Guidelines], asked ChatGPT to generate the schema file again, and it magically worked with all desired rules applied, voila!

<!-- References -->

[Python Style Guidelines]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/defective-ddl/Code/Python/PythonStyleGuidelines.md
[SQL Style Guidelines]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/main/Code/SQL/SQLStyleGuidelines.md
[defective-ddl]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/defective-ddl/Code/SQL/SQLStyleGuidelines.md