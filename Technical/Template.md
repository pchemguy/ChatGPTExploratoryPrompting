## ChatGPT assisted prompt debugging and fixing

I wanted to test ChatGPT on another coding exercise in the area of information management. The first step was to design a data model and the associated database schema. When generating potentially reusable code with ChatGPT, it is generally a good practice to submit appropriate style guidelines before requesting code generation. To this end, I prepared [Python][Python Style Guidelines] and [SQL][SQL Style Guidelines] style guidelines to use with ChatGPT. 

After submitting the SQL style guidelines, I conducted iterative schema development, asked ChatGPT to generate dummy data for testing purposes, and finally decided to verify the database schema and dummy data. However, when ChatGPT attempted to execute the Python script it generated for loading the schema and dummy data, it could not access the previously generated schema file. This issue could be expected, as temporary files generated by ChatGPT on the server (e.g., scripts) may be deleted at any time. Alternatively, I might have neglected to instruct ChatGPT to save the schema file on the server. Since I created and saved the schema blueprint locally, I could resolve this issue. I also had a local copy of the schema file, but I asked ChatGPT to reconstruct the schema from the blueprint specification. (The actual schema blueprint is unimportant and not shown.)

**ChatGPT prompt**

```
Use this blueprint to regenerate the schema file:

{SCHEMA BLUEPRINT}
```

ChatGPT successfully created the file with SQL code. However, this time it ignored the SQL style guidelines. This was unexpected because, during the interactive schema development phase, ChatGPT had followed the guidelines.

This prompted me to investigate further. The first step was to check the memory context. To do this, I asked:

**ChatGPT prompt**

```
Tell me about currently applicable guidelines for SQL code
```

While ChatGPT does not typically reproduce an exact copy of previously submitted text, examining the generated output and comparing it to the original text can help identify potential issues with the memory context. The output looked fine, but I decided to update the memory context anyway by resubmitting the SQL style guidelines. (`{SQL STYLE GUIDELINES}` is a placeholder; the actual prompt contained the content of the [file][defective-ddl].)

**ChatGPT prompt**

```
Replace currently applicable SQL Style Guidelines with new ones:

{SQL STYLE GUIDELINES}
```

ChatGPT confirmed the operation by indicating that the memory was updated and the SQL style guidelines had been successfully replaced. However, when I attempted to generate the schema file again, the result was the same: the style rules were ignored. I revised the guidelines to emphasize the ignored rules, repeated the process, but the outcome remained unchanged.

Next, I modified the prompt:

**ChatGPT prompt**

```
Use the following blueprint to generate the schema.sql file. Verify that schema.sql follows all applicable guidelines and adjust it if necessary.

{SCHEMA BLUEPRINT}
```

ChatGPT generated the schema file, again ignored the style rules, but reported that the code adhered to the guidelines. To further investigate, I explicitly included one of the ignored rules in the prompt:

**ChatGPT prompt**

```
Use the following blueprint to generate the schema.sql file. Generated schema file must include detailed comments.

{SCHEMA BLUEPRINT}
```

This time, the explicitly included style rule was applied. Encouraged by this result, I decided to start a new conversation to verify behavior. I submitted the style guidelines as before, asked ChatGPT to generate the schema file from its blueprint, and it ignored the style rules again, as I expected. I then encouraged ChatGPT to provide additional information:

**ChatGPT prompt**

```
Instructions:
Use the following blueprint to generate the schema.sql file.

Additional instructions:
Before producing the schema.sql file, show me detailed work. I am particularly interested in understanding your considerations as to which memory context items are applicable to the present task.

{SCHEMA BLUEPRINT}
```

ChatGPT provided the information, which appeared reasonable but not particularly insightful. I then directly inquired about one of the ignored rules:

**ChatGPT prompt**

```
Explain why you did not follow this instruction: "- Align column definitions after the column names." Is it not applicable? Why?
```

ChatGPT acknowledged that it ignored the rule but provided a detailed and reasonable explanation. Great! I then asked ChatGPT to help me refine the prompt to get the desired behavior:

**ChatGPT prompt**

```
Help me improve the following SQL Style Guidelines (I will provide specific requests in the following message):

{SCHEMA BLUEPRINT}
```

After confirmation, I submitted the second prompt with desired rules:

**ChatGPT prompt**

```
I want to make sure that when DDL code (schemas) is generated, the following formatting rules are enforced, unless specifically requested otherwise:

- All identifiers are quoted.
- Column definitions are aligned after the column names.
- Detailed comments are provided and aligned for column definition rows.
- Single-column UNIQUE and PRIMARY KEY constraints should always be included as part of the column definition and use bare keywords.
- Single-column constraints (except for UNIQUE and PRIMARY KEY) should be included as the last part of the column definition. Constraints should include descriptive names, start on a new line, and be indented by four spaces relative to the column name.
```

ChatGPT produced revised style guidelines. I switched to a new conversation again, used the revised [SQL style guidelines][SQL Style Guidelines], and asked ChatGPT to generate the schema file again. This time, all the desired rules were applied - voila!

<!-- References -->

[Python Style Guidelines]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/main/Code/Python/PythonStyleGuidelines.md
[SQL Style Guidelines]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/main/Code/SQL/SQLStyleGuidelines.md
[defective-ddl]: https://github.com/pchemguy/ChatGPTExploratoryPrompting/blob/defective-ddl/Code/SQL/SQLStyleGuidelines.md